{% extends 'base_no_title.html' %}


{% block body_id %}run-simulation{% endblock %}
{% block page_title %}{{ luncheon.name }}{% endblock %}


{% block content %}

<div id="svg-container" class="page-section">
  <svg width="100%">
    {% include 'svg_patterns.html' %}
  </svg>
</div>

<script type="text/javascript" charset="utf-8">
  var socket = io.connect('http://' + document.domain + ':' + location.port);

	socket.on('server hello', function() {
		console.log('Server said hello');
    socket.emit('client hello');
	});

	socket.on('server hello back', function() {
		console.log('Server said hello back to my hello');
	});

  const OVERPOPULATION_FACTOR = {{ OVERPOPULATION_FACTOR }};
  var numTablesX = {{ luncheon.num_tables_x }};
  var numTablesY = {{ luncheon.num_tables_y }};
  var initialState = {{ initial_state|safe }};

  {% if has_stage %}
    drawSeats(initialState, numTablesX, numTablesY, true);
  {% else %}
    drawSeats(initialState, numTablesX, numTablesY, false);
  {% endif %}

  var changes = {{ changes|safe }};
  for (var i = 0; i < changes.length; i++) {
    updateSeatRadii(changes[i], i);
  }

  /*
  setTimeout(function() {
    location.reload();
  }, TRANSITION_DURATION * changes.length + 200);
  */
</script>

<div id="final-states" class="page-section">
  <h3>Final state</h3>

  {% for table in luncheon.tables %}
    {% include 'table_snapshot.html' %}
  {% endfor %}
</div>

{% endblock %}
